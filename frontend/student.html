<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Student Dashboard</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="topbar">
      <h1 id="studentGreeting">Hello</h1>
      <nav>
        <button id="logoutBtn">Logout</button>
      </nav>
    </header>
    <main class="container">
      <section class="card">
        <h2>Available Courses</h2>
        <div class="actions">
          <input type="text" id="codeFilter" placeholder="Filter by code (e.g., CSC201)" />
          <button id="refreshAvail">Refresh</button>
        </div>
        <table class="table" id="availTable">
          <thead><tr><th>Course</th><th>Code</th><th>Lecturer</th><th>Ends</th><th></th></tr></thead>
          <tbody></tbody>
        </table>
      </section>

      <section class="card">
        <h2>Request OTP</h2>
        <form id="otpForm">
          <input type="hidden" id="sessionId" />
          <p class="muted">Select a course above, then request OTP.</p>
          <button type="submit">Request OTP</button>
          <p id="otpMsg" class="muted" aria-live="polite"></p>
        </form>
      </section>

      <section class="card">
        <h2>Mark Attendance</h2>
        <form id="submitForm">
          <input type="hidden" id="submitSessionId" />
          <label>OTP
            <input type="text" id="otp" required />
          </label>
          <button type="submit">Submit</button>
          <p id="submitMsg" class="muted" aria-live="polite"></p>
        </form>
      </section>

      <section class="card">
        <h2>Device Registration</h2>
        <p class="muted" id="deviceStatus">Checking device status...</p>
        <button id="registerDeviceBtn" type="button">Register Device</button>
        <p id="deviceMsg" class="muted" aria-live="polite"></p>
      </section>

      <section class="card">
        <h2>History</h2>
        <div class="history-controls">
          <label class="field">
            Course
            <select id="historyCourse">
              <option value="">All courses (last 7 only)</option>
            </select>
          </label>
          <label class="field">
            Range
            <select id="historyRange">
              <option value="last7" selected>Last 7 attendances</option>
              <option value="today">Today</option>
              <option value="yesterday">Yesterday</option>
              <option value="week">Last Week</option>
              <option value="month">Last Month</option>
              <option value="custom">Custom</option>
            </select>
          </label>
          <label id="historyFromWrap" class="field" style="display:none">
            From
            <input type="date" id="historyFrom" />
          </label>
          <label id="historyToWrap" class="field" style="display:none">
            To
            <input type="date" id="historyTo" />
          </label>
          <button id="historyApply" type="button">Apply</button>
        </div>
        <table class="table" id="historyTable">
          <thead>
            <tr><th>#</th><th>Date (WAT)</th><th>Time (WAT)</th><th>Course</th></tr>
          </thead>
          <tbody></tbody>
        </table>
        <p class="muted" id="historyNote">Showing your most recent 7 attendances across all courses.</p>
      </section>
    </main>
    <script src="js/config.js"></script>
    <script src="js/webauthn-helpers.js"></script>
    <script src="js/student.js"></script>
    <script src="js/student-filter.js"></script>
  </body>
  </html>
